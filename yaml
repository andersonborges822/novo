# steps.yaml
spec:
  name: Task Manager App
  description: Aplicação para gerenciamento de tarefas pessoais com filtros por prioridade, status e data.
  owner: user

steps:
  - id: setup-project
    name: Criar estrutura inicial do projeto
    run: |
      mkdir -p app/{static,templates,scripts}
      mkdir -p data
      touch app/__init__.py
      echo "Estrutura inicial criada."
    verify: test -d app && test -d data

  - id: install-dependencies
    name: Instalar dependências
    run: |
      pip install flask flask_sqlalchemy
    verify: python -c "import flask"

  - id: create-database
    name: Configurar banco de dados SQLite
    run: |
      cat > app/models.py <<EOF
      from flask_sqlalchemy import SQLAlchemy

      db = SQLAlchemy()

      class Task(db.Model):
          id = db.Column(db.Integer, primary_key=True)
          title = db.Column(db.String(100), nullable=False)
          description = db.Column(db.Text)
          due_date = db.Column(db.Date)
          priority = db.Column(db.String(20))
          status = db.Column(db.String(20), default='Pendente')
      EOF
    verify: test -f app/models.py

  - id: create-app
    name: Criar aplicação Flask principal
    run: |
      cat > app/main.py <<EOF
      from flask import Flask, render_template, request, redirect, url_for
      from models import db, Task
      from datetime import datetime

      app = Flask(__name__)
      app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///data/tasks.db'
      db.init_app(app)

      @app.route('/')
      def index():
          status = request.args.get('status')
          priority = request.args.get('priority')
          date = request.args.get('date')

          query = Task.query
          if status:
              query = query.filter_by(status=status)
          if priority:
              query = query.filter_by(priority=priority)
          if date:
              query = query.filter(Task.due_date == date)

          tasks = query.all()
          return render_template('index.html', tasks=tasks)

      @app.route('/add', methods=['POST'])
      def add_task():
          title = request.form['title']
          description = request.form['description']
          due_date = datetime.strptime(request.form['due_date'], '%Y-%m-%d')
          priority = request.form['priority']
          status = request.form['status']
          new_task = Task(title=title, description=description, due_date=due_date, priority=priority, status=status)
          db.session.add(new_task)
          db.session.commit()
          return redirect(url_for('index'))

      if __name__ == '__main__':
          with app.app_context():
              db.create_all()
          app.run(debug=True)
      EOF
    verify: test -f app/main.py

  - id: create-template
    name: Criar template HTML básico
    run: |
      cat > app/templates/index.html <<EOF
      <!DOCTYPE html>
      <html lang="pt-BR">
      <head>
          <meta charset="UTF-8">
          <title>Gerenciador de Tarefas</title>
      </head>
      <body>
          <h1>Minhas Tarefas</h1>
          <form method="get">
              <select name="status">
                  <option value="">Status</option>
                  <option value="Pendente">Pendente</option>
                  <option value="Em andamento">Em andamento</option>
                  <option value="Concluída">Concluída</option>
              </select>
              <select name="priority">
                  <option value="">Prioridade</option>
                  <option value="Baixa">Baixa</option>
                  <option value="Média">Média</option>
                  <option value="Alta">Alta</option>
              </select>
              <input type="date" name="date">
              <button type="submit">Filtrar</button>
          </form>
          <ul>
              {% for task in tasks %}
                  <li>{{ task.title }} - {{ task.priority }} - {{ task.status }} - {{ task.due_date }}</li>
              {% endfor %}
          </ul>
      </body>
      </html>
      EOF
    verify: test -f app/templates/index.html

  - id: test-app
    name: Testar inicialização da aplicação
    run: python app/main.py
    verify: echo "Verifique se o servidor Flask iniciou corretamente."

